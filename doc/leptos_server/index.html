<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Leptos Server Functions"><title>leptos_server - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-fa3bb1812debf86c.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="leptos_server" data-themes="" data-resource-suffix="" data-rustdoc-version="1.75.0-nightly (bf9a1c8a1 2023-10-08)" data-channel="nightly" data-search-js="search-5f5ec5419eadd0c9.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-c5bd66d33317d69f.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../leptos_server/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a></nav><nav class="sidebar"><a class="logo-container" href="../leptos_server/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate leptos_server</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.5.1</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">leptos_server</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/leptos_server/lib.rs.html#1-372">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="leptos-server-functions"><a href="#leptos-server-functions">Leptos Server Functions</a></h2>
<p>This package is based on a simple idea: sometimes it’s useful to write functions
that will only run on the server, and call them from the client.</p>
<p>If you’re creating anything beyond a toy app, you’ll need to do this all the time:
reading from or writing to a database that only runs on the server, running expensive
computations using libraries you don’t want to ship down to the client, accessing
APIs that need to be called from the server rather than the client for CORS reasons
or because you need a secret API key that’s stored on the server and definitely
shouldn’t be shipped down to a user’s browser.</p>
<p>Traditionally, this is done by separating your server and client code, and by setting
up something like a REST API or GraphQL API to allow your client to fetch and mutate
data on the server. This is fine, but it requires you to write and maintain your code
in multiple separate places (client-side code for fetching, server-side functions to run),
as well as creating a third thing to manage, which is the API contract between the two.</p>
<p>This package provides two simple primitives that allow you instead to write co-located,
isomorphic server functions. (<em>Co-located</em> means you can write them in your app code so
that they are “located alongside” the client code that calls them, rather than separating
the client and server sides. <em>Isomorphic</em> means you can call them from the client as if
you were simply calling a function; the function call has the “same shape” on the client
as it does on the server.)</p>
<h4 id="server"><a href="#server"><code>#[server]</code></a></h4>
<p>The <a href="https://docs.rs/leptos/latest/leptos/attr.server.html"><code>#[server]</code></a> macro allows you to annotate a function to
indicate that it should only run on the server (i.e., when you have an <code>ssr</code> feature in your
crate that is enabled).</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">use </span>leptos::<span class="kw-2">*</span>;
<span class="attr">#[server(ReadFromDB)]
</span><span class="kw">async fn </span>read_posts(how_many: usize, query: String) -&gt; <span class="prelude-ty">Result</span>&lt;Vec&lt;Posts&gt;, ServerFnError&gt; {
  <span class="comment">// do some server-only work here to access the database
  </span><span class="kw">let </span>posts = <span class="macro">todo!</span>();;
  <span class="prelude-val">Ok</span>(posts)
}

<span class="comment">// call the function
</span>spawn_local(<span class="kw">async </span>{
  <span class="kw">let </span>posts = read_posts(<span class="number">3</span>, <span class="string">&quot;my search&quot;</span>.to_string()).<span class="kw">await</span>;
  <span class="macro">log::debug!</span>(<span class="string">&quot;posts = {posts:#?}&quot;</span>);
});</code></pre></div>
<p>If you call this function from the client, it will serialize the function arguments and <code>POST</code>
them to the server as if they were the inputs in <code>&lt;form method=&quot;POST&quot;&gt;</code>.</p>
<p>Here’s what you need to remember:</p>
<ul>
<li><strong>Server functions must be <code>async</code>.</strong> Even if the work being done inside the function body
can run synchronously on the server, from the client’s perspective it involves an asynchronous
function call.</li>
<li><strong>Server functions must return <code>Result&lt;T, ServerFnError&gt;</code>.</strong> Even if the work being done
inside the function body can’t fail, the processes of serialization/deserialization and the
network call are fallible.</li>
<li><strong>Return types must be <a href="../leptos_reactive/serialization/trait.Serializable.html" title="trait leptos_reactive::serialization::Serializable">Serializable</a>.</strong>
This should be fairly obvious: we have to serialize arguments to send them to the server, and we
need to deserialize the result to return it to the client.</li>
<li><strong>Arguments must be implement <a href="../serde/ser/trait.Serialize.html" title="trait serde::ser::Serialize">serde::Serialize</a>.</strong> They are serialized as an <code>application/x-www-form-urlencoded</code>
form data using <a href="https://docs.rs/serde_qs/latest/serde_qs/"><code>serde_qs</code></a> or as <code>application/cbor</code>
using <a href="https://docs.rs/cbor/latest/cbor/"><code>cbor</code></a>. <strong>Note</strong>: You should explicitly include <code>serde</code> with the
<code>derive</code> feature enabled in your <code>Cargo.toml</code>. You can do this by running <code>cargo add serde --features=derive</code>.</li>
<li>Context comes from the server. <a href="../leptos_reactive/context/fn.use_context.html" title="fn leptos_reactive::context::use_context"><code>use_context</code></a> can be used to access specific
server-related data, as documented in the server integrations. This allows accessing things like HTTP request
headers as needed. However, server functions <em>not</em> have access to reactive state that exists in the client.</li>
</ul>
<h3 id="server-function-encodings"><a href="#server-function-encodings">Server Function Encodings</a></h3>
<p>By default, the server function call is a <code>POST</code> request that serializes the arguments as URL-encoded form data in the body
of the request. But there are a few other methods supported. Optionally, we can provide another argument to the <code>#[server]</code>
macro to specify an alternate encoding:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="attr">#[server(AddTodo, <span class="string">&quot;/api&quot;</span>, <span class="string">&quot;Url&quot;</span>)]
#[server(AddTodo, <span class="string">&quot;/api&quot;</span>, <span class="string">&quot;GetJson&quot;</span>)]
#[server(AddTodo, <span class="string">&quot;/api&quot;</span>, <span class="string">&quot;Cbor&quot;</span>)]
#[server(AddTodo, <span class="string">&quot;/api&quot;</span>, <span class="string">&quot;GetCbor&quot;</span>)]</span></code></pre></div>
<p>The four options use different combinations of HTTP verbs and encoding methods:</p>
<div><table><thead><tr><th>Name</th><th>Method</th><th>Request</th><th>Response</th></tr></thead><tbody>
<tr><td><strong>Url</strong> (default)</td><td>POST</td><td>URL encoded</td><td>JSON</td></tr>
<tr><td><strong>GetJson</strong></td><td>GET</td><td>URL encoded</td><td>JSON</td></tr>
<tr><td><strong>Cbor</strong></td><td>POST</td><td>CBOR</td><td>CBOR</td></tr>
<tr><td><strong>GetCbor</strong></td><td>GET</td><td>URL encoded</td><td>CBOR</td></tr>
</tbody></table>
</div>
<p>In other words, you have two choices:</p>
<ul>
<li><code>GET</code> or <code>POST</code>? This has implications for things like browser or CDN caching; while <code>POST</code> requests should not be cached,
<code>GET</code> requests can be.</li>
<li>Plain text (arguments sent with URL/form encoding, results sent as JSON) or a binary format (CBOR, encoded as a base64
string)?</li>
</ul>
<h3 id="why-not-put-or-delete-why-urlform-encoding-and-not-json"><a href="#why-not-put-or-delete-why-urlform-encoding-and-not-json">Why not <code>PUT</code> or <code>DELETE</code>? Why URL/form encoding, and not JSON?**</a></h3>
<p>These are reasonable questions. Much of the web is built on REST API patterns that encourage the use of semantic HTTP
methods like <code>DELETE</code> to delete an item from a database, and many devs are accustomed to sending data to APIs in the
JSON format.</p>
<p>The reason we use <code>POST</code> or <code>GET</code> with URL-encoded data by default is the <code>&lt;form&gt;</code> support. For better or for worse,
HTML forms don’t support <code>PUT</code> or <code>DELETE</code>, and they don’t support sending JSON. This means that if you use anything
but a <code>GET</code> or <code>POST</code> request with URL-encoded data, it can only work once WASM has loaded.</p>
<p>The CBOR encoding is suported for historical reasons; an earlier version of server functions used a URL encoding that
didn’t support nested objects like structs or vectors as server function arguments, which CBOR did. But note that the
CBOR forms encounter the same issue as <code>PUT</code>, <code>DELETE</code>, or JSON: they do not degrade gracefully if the WASM version of
your app is not available.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Action.html" title="struct leptos_server::Action">Action</a></div><div class="desc docblock-short">An action synchronizes an imperative <code>async</code> call to the synchronous reactive system.</div></li><li><div class="item-name"><a class="struct" href="struct.LeptosServerFnRegistry.html" title="struct leptos_server::LeptosServerFnRegistry">LeptosServerFnRegistry</a></div><div class="desc docblock-short">The registry of all Leptos server functions.</div></li><li><div class="item-name"><a class="struct" href="struct.MultiAction.html" title="struct leptos_server::MultiAction">MultiAction</a></div><div class="desc docblock-short">An action that synchronizes multiple imperative <code>async</code> calls to the reactive system,
tracking the progress of each one.</div></li><li><div class="item-name"><a class="struct" href="struct.ServerFnTraitObj.html" title="struct leptos_server::ServerFnTraitObj">ServerFnTraitObj</a></div><div class="desc docblock-short">A concrete type for a server function.</div></li><li><div class="item-name"><a class="struct" href="struct.Submission.html" title="struct leptos_server::Submission">Submission</a></div><div class="desc docblock-short">An action that has been submitted by dispatching it to a <a href="struct.MultiAction.html" title="struct leptos_server::MultiAction">MultiAction</a>.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Encoding.html" title="enum leptos_server::Encoding">Encoding</a></div><div class="desc docblock-short">Holds the current options for encoding types.
More could be added, but they need to be serde</div></li><li><div class="item-name"><a class="enum" href="enum.Payload.html" title="enum leptos_server::Payload">Payload</a></div><div class="desc docblock-short">A dual type to hold the possible Response datatypes</div></li><li><div class="item-name"><a class="enum" href="enum.ServerFnError.html" title="enum leptos_server::ServerFnError">ServerFnError</a></div><div class="desc docblock-short">Type for errors that can occur when using server functions.</div></li><li><div class="item-name"><a class="enum" href="enum.ServerFnErrorErr.html" title="enum leptos_server::ServerFnErrorErr">ServerFnErrorErr</a></div><div class="desc docblock-short">Type for errors that can occur when using server functions.</div></li><li><div class="item-name"><a class="enum" href="enum.ServerRegistrationFnError.html" title="enum leptos_server::ServerRegistrationFnError">ServerRegistrationFnError</a></div><div class="desc docblock-short">Errors that can occur when registering a server function.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.ServerFn.html" title="trait leptos_server::ServerFn">ServerFn</a></div><div class="desc docblock-short">Defines a “server function.” A server function can be called from the server or the client,
but the body of its code will only be run on the server, i.e., if a crate feature <code>ssr</code> is enabled.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.create_action.html" title="fn leptos_server::create_action">create_action</a></div><div class="desc docblock-short">Creates an <a href="struct.Action.html" title="struct leptos_server::Action">Action</a> to synchronize an imperative <code>async</code> call to the synchronous reactive system.</div></li><li><div class="item-name"><a class="fn" href="fn.create_multi_action.html" title="fn leptos_server::create_multi_action">create_multi_action</a></div><div class="desc docblock-short">Creates an <a href="struct.MultiAction.html" title="struct leptos_server::MultiAction">MultiAction</a> to synchronize an imperative <code>async</code> call to the synchronous reactive system.</div></li><li><div class="item-name"><a class="fn" href="fn.create_server_action.html" title="fn leptos_server::create_server_action">create_server_action</a></div><div class="desc docblock-short">Creates an <a href="struct.Action.html" title="struct leptos_server::Action">Action</a> that can be used to call a server function.</div></li><li><div class="item-name"><a class="fn" href="fn.create_server_multi_action.html" title="fn leptos_server::create_server_multi_action">create_server_multi_action</a></div><div class="desc docblock-short">Creates an <a href="struct.MultiAction.html" title="struct leptos_server::MultiAction">MultiAction</a> that can be used to call a server function.</div></li><li><div class="item-name"><a class="fn" href="fn.server_fn_by_path.html" title="fn leptos_server::server_fn_by_path">server_fn_by_path</a></div><div class="desc docblock-short">Get a ServerFunction struct containing info about the server fn</div></li><li><div class="item-name"><a class="fn" href="fn.server_fn_encoding_by_path.html" title="fn leptos_server::server_fn_encoding_by_path">server_fn_encoding_by_path</a></div><div class="desc docblock-short">Get the Encoding of a server fn if one is registered at that path. Otherwise, return None</div></li><li><div class="item-name"><a class="fn" href="fn.server_fn_trait_obj_by_path.html" title="fn leptos_server::server_fn_trait_obj_by_path">server_fn_trait_obj_by_path</a></div><div class="desc docblock-short">Attempts to find a server function registered at the given path.</div></li><li><div class="item-name"><a class="fn" href="fn.server_fns_by_path.html" title="fn leptos_server::server_fns_by_path">server_fns_by_path</a></div><div class="desc docblock-short">Returns the set of currently-registered server function paths, for debugging purposes.</div></li></ul></section></div></main></body></html>